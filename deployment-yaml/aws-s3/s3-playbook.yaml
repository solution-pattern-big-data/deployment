---
- name: Create S3 bucket and upload the data
  hosts: localhost
  tasks:
  - name: Create Public S3 bucket
    amazon.aws.s3_bucket:
      name: "{{ lookup('ansible.builtin.env', 'AWS_BUCKET') }}"
      #name: gmidha-bigdata-nov09
      state: present
      region: us-east-2
      versioning: true 
      encryption: "AES256"
      public_access:
        block_public_acls: false
    register: s3bucket
  - name: Upload Data in S3 bucket
    shell: >
      aws s3 cp ../../data/IBM.csv s3://"{{ lookup('ansible.builtin.env', 'AWS_BUCKET') }}"/IBM.csv
  - name: Upload Data in S3 bucket
    shell: >
      aws s3 cp ../../data/msftdata.csv s3://"{{ lookup('ansible.builtin.env', 'AWS_BUCKET') }}"/msftdata.csv
